name: 'Summarize Stage'
description: 'Generate a comprehensive summary of any stage results with customizable success content'
author: 'Optivem'

branding:
  icon: 'clipboard'
  color: 'blue'

inputs:
  stage-result:
    description: 'Result of the stage job (success, failure, cancelled, etc.)'
    required: true
  stage-name:
    description: 'Name of the stage being summarized'
    required: true
  stage-success-emoji:
    description: 'Emoji to display for successful stages'
    required: false
    default: 'âœ…'
  stage-failure-emoji:
    description: 'Emoji to display for failed stages'
    required: false
    default: 'âŒ'
  stage-cancelled-emoji:
    description: 'Emoji to display for cancelled stages'
    required: false
    default: 'ðŸ›‘'
  stage-unknown-emoji:
    description: 'Emoji to display for unknown stage status'
    required: false
    default: 'âš ï¸'
  stage-success-content:
    description: 'Custom content to display on success (supports markdown)'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Generate Stage Summary
      shell: bash
      run: |
        echo "# ${{ inputs.stage-name }} Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Check stage job result
        STAGE_RESULT="${{ inputs.stage-result }}"
        
        if [[ "$STAGE_RESULT" == "success" ]]; then
          echo "## ${{ inputs.stage-success-emoji }} ${{ inputs.stage-name }} Succeeded" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Add custom success content if provided
          if [[ -n "${{ inputs.stage-success-content }}" ]]; then
            cat << 'EOF' >> $GITHUB_STEP_SUMMARY
        ${{ inputs.stage-success-content }}
        EOF
          else
            # Default success message
            echo "Stage completed successfully." >> $GITHUB_STEP_SUMMARY
          fi
          
        elif [[ "$STAGE_RESULT" == "failure" ]]; then
          echo "## ${{ inputs.stage-failure-emoji }} ${{ inputs.stage-name }} Failed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "The stage process encountered an error. Check the job logs for details." >> $GITHUB_STEP_SUMMARY
          
        elif [[ "$STAGE_RESULT" == "cancelled" ]]; then
          echo "## ${{ inputs.stage-cancelled-emoji }} ${{ inputs.stage-name }} Cancelled" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "â¹ï¸ **Stage process was cancelled**" >> $GITHUB_STEP_SUMMARY
          
        else
          echo "## ${{ inputs.stage-unknown-emoji }} ${{ inputs.stage-name }} Status Unknown" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "â“ **Stage result:** \`$STAGE_RESULT\`" >> $GITHUB_STEP_SUMMARY
        fi