name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test-action:
    name: Test Action
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Test Success Case
        uses: ./
        with:
          stage-result: 'success'
          stage-name: 'CI Test'
          stage-success-content: |
            ## Test Summary
            ✅ **Action test completed successfully!**
            
            This demonstrates that the action is working correctly.

      - name: Test Failure Case
        uses: ./
        with:
          stage-result: 'failure'
          stage-name: 'Failure Test'

      - name: Test Cancellation Case
        uses: ./
        with:
          stage-result: 'cancelled'
          stage-name: 'Cancellation Test'

  check-action:
    name: Check Action
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate action.yml
        run: |
          # Check that required fields are present
          if ! grep -q "name:" action.yml; then
            echo "Error: action.yml missing 'name' field"
            exit 1
          fi
          
          if ! grep -q "description:" action.yml; then
            echo "Error: action.yml missing 'description' field"
            exit 1
          fi
          
          if ! grep -q "runs:" action.yml; then
            echo "Error: action.yml missing 'runs' field"
            exit 1
          fi
          
          echo "✅ action.yml validation passed"